name: Build
on: push

jobs:
  build:
    runs-on: ubuntu-22.04
    container:
      image: carlonluca/qt-builder:jammy
    steps:
      - name: Checkout
        uses: actions/checkout@v3
        with:
          submodules: recursive
      - name: Build
        shell: bash
        run: |
          mkdir /root/export
          mkdir build
          version=6.5.0-beta2
          git clone --verbose --depth 1 --branch v$version https://code.qt.io/qt/qt5.git
          cd qt5
          perl init-repository --module-subset=default,-qtwebengine
          cd ..
          cd build
          ../qt5/configure -release -nomake examples -nomake tests -no-zstd -webengine-proprietary-codecs -prefix /opt/Qt-amd64-$version -- -DFEATURE_ffmpeg=OFF
          cmake --build . --parallel $(($(nproc)+4))
          cmake --install .
          cp config.summary /opt/Qt-amd64-$version/
          cd /opt
          tar cvfpJ Qt-amd64-$version.tar.xz /opt/Qt-amd64-$version
      - name: Archive
        uses: actions/upload-artifact@v3
        with:
          name: Qt-amd64
          path: /opt/Qt-amd64-$version.tar.xz